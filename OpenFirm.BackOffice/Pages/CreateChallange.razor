@page "/create-challange"
@inject HttpClient Http
@inject ISnackbar Snackbar

<MudText Typo="Typo.h3" GutterBottom="true">Start new Challange</MudText>

<MudPaper Class="pa-4" MaxWidth="500px">
    <MudForm>
        <MudTextField @bind-Value="traderName" Label="Name" Variant="Variant.Outlined" Margin="Margin.Dense"/>

        <MudSelect T="decimal" Label="Choose a Package" @bind-Value="selectedBalance" Variant="Variant.Outlined" Class="mt-4">
            <MudSelectItem Value="10000m">Tier 1 (10.000$)</MudSelectItem>
            <MudSelectItem Value="25000m">Tier 1 (25.000$)</MudSelectItem>
            <MudSelectItem Value="50000m">Tier 1 (50.000$)</MudSelectItem>
        </MudSelect>

        <MudButton Variant="Variant.Filled" Color="Color.Primary" Class="mt-4" OnClick="CreateAccount">
            Create Account
        </MudButton>
    </MudForm>
</MudPaper>

@code {
    private string traderName = "";
    private decimal selectedBalance = 10_000m;

    private async Task CreateAccount()
    {
        var requestData = new
        {
            traderName = traderName,
            startingCapital = selectedBalance
        };

        var response = await Http.PostAsync($"https://localhost:7235/api/Account/start-challange?traderName={traderName}&startingCapital={selectedBalance}", null);
        if (response.IsSuccessStatusCode)
        {
            Snackbar.Add($"Your account has been created. Name: {traderName}", Severity.Success);
        }
        else
        {
            var error = await response.Content.ReadAsStringAsync();
            Snackbar.Add($"Something went wrong: {response.StatusCode}: {error}", Severity.Error);
        }
    }
}
